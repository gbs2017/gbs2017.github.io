function Person(id){this.id=parseInt(id);if(Person.memo[this.id]){return Person.memo[this.id]}else{Person.memo[this.id]=this}this.is_ready=false;this.has_notes=false;var that=this;this.ready_functions=[];this.trigger_ready=function(){this.is_ready=true;var funcs=this.ready_functions;this.ready_functions=[];$.each(funcs,function(index,func){func(that)})};this.ready=function(ready_function){this.ready_functions.push(ready_function);if(this.is_ready)this.trigger_ready()};this.hasBirth=function(){return typeof this.birth!="undefined"};this.hasDeath=function(){return typeof this.death!="undefined"};this.hasChildren=function(){return this.children.length>0};this.hasNotes=function(){return this.has_notes};this.createPersonPlaceHolder=function(id){return{id:parseInt(id),fetch:function(){return new Person(id)}}};this.createFamilyPlaceHolder=function(id){return{id:parseInt(id),children:that.getChildren(id),current_child:that.getCurrentChild(id),spouse:that.getSpouse(id),events:that.getEvents(id)}};this.createParentFamilyPlaceHolder=function(id,rel){return{id:parseInt(id),rel:rel,siblings:that.getSiblings(id),father:that.getParent("father",id),mother:that.getParent("mother",id)}};this.getSpouseId=function(family_id){if(family_id){return parseInt(this.xml.find("family[id='"+family_id.toString()+"']").find("spouse").text())}else{if(this.current_family){return this.current_family.spouse.id}else{return parseInt(this.xml.find("family:first").find("spouse").text())}}};this.getSpouse=function(family_id){return this.createPersonPlaceHolder(this.getSpouseId(family_id))};this.getParentId=function(relationship,parents_id){if(parents_id){return parseInt(this.xml.find("parents[id='"+parents_id.toString()+"']").find(relationship).text())}else{if(this.current_parents){return this.current_parents[relationship].id}else{return parseInt(this.xml.find("parents:first").find(relationship).text())}}};this.getParent=function(relationship,parents_id){var id=this.getParentId(relationship,parents_id);if(!$.isNumeric(id))return null;return this.createPersonPlaceHolder(id)};this.getChildIds=function(family_id){var children=[];if(family_id){this.xml.find("family[id='"+family_id.toString()+"']").find("child").each(function(index,child){children.push(parseInt($(child).attr("id")))})}else{this.xml.find("child").each(function(index,child){children.push(parseInt($(child).attr("id")))})}return children};this.getChildren=function(family_id){var child_ids=this.getChildIds(family_id);var children=[];$.each(child_ids,function(index,child_id){children.push(that.createPersonPlaceHolder(child_id))});return children};this.getCurrentChild=function(family_id){if(!family_id){if(this.current_family){var family_id=this.current_family}else{var family_id=this.xml.find("family:first").attr("id");if(!family_id)return null}}var current_child=this.xml.find("family[id='"+family_id.toString()+"']").find("currentchild").text();if(current_child){return this.createPersonPlaceHolder(current_child)}else{var children=this.xml.find("family[id='"+family_id.toString()+"']").find("child");if(children.length>0){return this.createPersonPlaceHolder($(children[0]).attr("id"))}else{return null}}};this.getFamilyIds=function(){var families=[];this.xml.find("family").each(function(index,family){families.push(parseInt($(family).attr("id")))});return families};this.getFamilies=function(){var families=[];this.xml.find("family").each(function(index,family){families.push(that.createFamilyPlaceHolder($(family).attr("id")))});return families};this.getParentFamilyIds=function(){var parents=[];this.xml.find("parents").each(function(index,parent){parents.push(parseInt($(parent).attr("id")))});return parents};this.getParentFamilies=function(){var parents=[];this.xml.find("parents").each(function(index,parent){parents.push(that.createParentFamilyPlaceHolder($(parent).attr("id"),$(parent).attr("rel")))});return parents};this.getSiblingIds=function(parents_id){var siblings=[];if(parents_id){this.xml.find("parents[id='"+parents_id.toString()+"']").find("sibling").each(function(index,sibling){siblings.push(parseInt($(sibling).attr("id")))})}else{this.xml.find("sibling").each(function(index,sibling){siblings.push(parseInt($(sibling).attr("id")))})}return siblings};this.getSiblings=function(parents_id){var sibling_ids=this.getSiblingIds(parents_id);var siblings=[];$.each(sibling_ids,function(index,sibling_id){siblings.push(that.createPersonPlaceHolder(sibling_id))});return siblings};this.getEvents=function(family_id){var events=[];var event_selector="person > event";if(family_id){event_selector="family[id='"+family_id.toString()+"'] > event"}this.xml.find(event_selector).each(function(index,xml_event){var event={};xml_event=$(xml_event);xml_event.children().each(function(index,child){if($.inArray(child.tagName,["sources","media"])==-1){event[child.tagName]=$(child).text()}});event.sources=parseSources(xml_event.find("sources"));event.media=parseMedia(xml_event.children("media"));if(event.note)that.has_notes=true;if(!family_id){if(event.type=="Birth"&&(typeof that.birth=="undefined"||xml_event.attr("primary")=="true"))that.birth=event;if(event.type=="Death"&&(typeof that.death=="undefined"||xml_event.attr("primary")=="true"))that.death=event}events.push(event)});return events};requestXML("person",this.id,function(xml){that.xml=xml;that.name=xml.find("person > name").text();that.gender=xml.find("gender").text();that.image=xml.find("image").text();that.box_color=xml.find("color").text();that.note=xml.find("person > note").text();that.sources=parseSources(xml.find("person > sources"));that.webtags=parseWebtags(xml.find("person > webtags"));that.media=parseMedia(xml.find("person > media"));var primaries=xml.find("person > media mediaitem[primary='true'] filename");if(primaries.length>0){that.image=$(primaries[0]).text()}that.events=that.getEvents();that.parents=that.getParentFamilies();that.siblings=that.getSiblings();var current_parents_id=xml.find("currentparents").text();if(current_parents_id){that.current_parents=that.createParentFamilyPlaceHolder(current_parents_id)}else if(that.parents.length>0){that.current_parents=that.parents[0]}if(that.current_parents){that.father=that.current_parents.father;that.mother=that.current_parents.mother}that.families=that.getFamilies();that.children=that.getChildren();var current_family_id=xml.find("currentspouse").text();if(current_family_id){that.current_family=that.createFamilyPlaceHolder(current_family_id)}else if(that.families.length>0){that.current_family=that.families[0]}if(that.current_family){that.current_child=that.current_family.current_child}if(!that.current_child&&that.current_family&&that.current_family.children.length>0){that.current_child=that.current_family.children[0]}else if(!that.current_child&&that.children.length>0){that.current_child=that.children[0]}that.trigger_ready()})}Person.memo={};