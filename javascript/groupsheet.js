$(document).ready(function(){$(window).hashchange(function(){$("body").off("click");var family_id=1;if(location.hash.length>0){family_id=parseInt(location.hash.substring(1))}var family=new Family(family_id);family.ready(displayFamilyInfo)});$(window).hashchange()});function displayFamilyInfo(family){var footnote_counter=new FootnoteCounter;$("#general-note").empty().append(family.note);$("#notes").empty();if(family.note)$("#notes").append("<h2>Family Notes</h2>",family.note);$("#sources").empty();if(family.sources.length>0){$("#sources").replaceWith(footnoteDiv(family.sources,"sources",{header:"Sources"}))}$("#sources").prepend("<h2>Endnotes</h2>");var groupsheet=$("#group-sheet");groupsheet.empty();groupsheet.append("<div class='father'><h3>FATHER <span class='name'></span></h3></div>");groupsheet.append("<div class='mother'><h3>MOTHER <span class='name'></span></h3></div>");if(family.children.length>0){groupsheet.append("<h3>CHILDREN</h3><div class='children'></div>")}if(family.father){family.father.fetch().ready(function(father){var $f=$("#group-sheet .father");nameLink(father,{defaultPage:"parents"}).appendTo($f.find(".name"));buildGroupsheetTable(father,family,footnote_counter).appendTo($f)})}if(family.mother){family.mother.fetch().ready(function(mother){var $m=$("#group-sheet .mother");nameLink(mother,{defaultPage:"parents"}).appendTo($m.find(".name"));buildGroupsheetTable(mother,family,footnote_counter).appendTo($m)})}if(family.children.length>0){var $c=$("#group-sheet .children");$.each(family.children,function(index,child){var child_div=$("<div class='child'>");$c.append(child_div);child.fetch().ready(function(child){$name_link=nameLink(child,{defaultPage:"family",showGender:true});$name_link.find("a.person").addClass(child.gender);$name_link.appendTo(child_div);buildGroupsheetTable(child,family,footnote_counter).appendTo(child_div)})})}}function buildGroupsheetTable(person,family,counter){var $note_head=$("<span/>").appendTo("#notes");if(person.name){if(person.hasNotes()){$note_head.append("<h2>Notes for "+person.name+"</h2>");if(person.note){$note_head.append("<h3>General</h3>",person.note)}}}else{person.fetch(function(){if(person.hasNotes()){$note_head.append("<h2>Notes for "+person.name+"</h2>");if(person.note){$note_head.append("<h3>General</h3>",person.note)}}})}var $table=buildEventTable(person.events,{counter:counter});var other_families=[];$.each(person.families,function(index,f){if(family.id==f.id){$table.extendEvents(f.events)}else{other_families.push(f)}});var spouse_text="Spouse";if(family.father&&person.id==family.father.id||family.mother&&person.id==family.mother.id){if(person.current_parents){if(person.current_parents.father)$table.addPerson("Father",person.current_parents.father,{defaultPage:"family"});if(person.current_parents.mother)$table.addPerson("Mother",person.current_parents.mother,{defaultPage:"family"})}spouse_text="Other Spouse"}$.each(other_families,function(index,f){$table.addPerson(spouse_text,f.spouse)});return $table}